<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Thanh Toán - Phêla</title>

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
        <link rel="stylesheet" href="/client/css/style.css" />
        <link rel="stylesheet" href="/client/css/cart/checkout.css" />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet/dist/leaflet.css"
        />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <!-- Font-->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
            rel="stylesheet"
        />

        <!--Favicon-->
        <link
            rel="shortcut icon"
            href="/images/favicon/favicon.ico"
            type="image/x-icon"
        />
        <link
            rel="icon"
            href="/images/favicon/favicon.ico"
            type="image/x-icon"
        />

        <!-- Bootstrap Icons -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.min.css"
        />

        <!-- Custom CSS -->
    </head>
    <body class="bg-light">
        <%- include('../layout/navbar_login.ejs'); -%>
        <main class="py-4">
            <div class="container-lg">
                <!-- Page Title -->
                <div class="mb-5 cart-title">
                    <h1 class="page-title">Thanh Toán</h1>
                    <p class="text-muted">
                        Vui lòng kiểm tra thông tin để thanh toán
                    </p>
                    <hr />
                </div>
                <div class="row g-4">
                    <!-- Left Column - Buyer Information -->
                    <div class="col-lg-7">
                        <div class="card border-light shadow-sm">
                            <h1 class="card-title py-4 px-5">
                                Thông Tin Của Bạn
                            </h1>
                            <div class="card-body px-5">
                                <form
                                    id="checkoutForm"
                                    class="needs-validation"
                                    novalidate
                                >
                                    <!-- Full Name and Phone -->
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label
                                                for="firstName"
                                                class="form-label fw-medium"
                                                >Full Name</label
                                            >
                                            <input
                                                type="text"
                                                class="form-control form-control-lg bg-light"
                                                id="firstName"
                                                name="firstName"
                                                placeholder="Your full name"
                                                value="<%= user?.username || '' %>"
                                                required
                                            />
                                        </div>
                                        <div class="col-md-6">
                                            <label
                                                for="phone"
                                                class="form-label fw-medium"
                                                >Phone</label
                                            >
                                            <input
                                                type="tel"
                                                class="form-control form-control-lg bg-light"
                                                id="phone"
                                                name="phone"
                                                placeholder="Phone number"
                                                value="<%= user?.phone || '' %>"
                                                required
                                            />
                                        </div>
                                    </div>

                                    <!-- Email -->
                                    <div class="mb-4">
                                        <label
                                            for="email"
                                            class="form-label fw-medium"
                                            >Email</label
                                        >
                                        <input
                                            type="email"
                                            class="form-control form-control-lg bg-light"
                                            id="email"
                                            name="email"
                                            placeholder="Email address"
                                            value="<%= user?.email || '' %>"
                                            required
                                        />
                                    </div>

                                    <!-- Address -->
                                    <div class="mb-4">
                                        <label
                                            for="addressBtn"
                                            class="form-label fw-medium"
                                            >Địa chỉ cụ thể</label
                                        >
                                        <button
                                            type="button"
                                            class="form-control form-control-lg bg-light text-start"
                                            id="addressBtn"
                                        >
                                            <span id="addressDisplay">
                                                <%= user?.address ? user.address
                                                : 'Chọn địa chỉ giao hàng' %>
                                            </span>
                                        </button>
                                        <input
                                            type="hidden"
                                            id="address"
                                            name="address"
                                            value="<%= user?.address || '' %>"
                                        />
                                        <input
                                            type="hidden"
                                            id="province"
                                            name="province"
                                            value=""
                                        />
                                        <input
                                            type="hidden"
                                            id="district"
                                            name="district"
                                            value=""
                                        />
                                    </div>

                                    <!-- Order Notes -->
                                    <div class="mb-4">
                                        <label
                                            for="notes"
                                            class="form-label fw-medium"
                                            >Order Notes (Optional)</label
                                        >
                                        <textarea
                                            class="form-control form-control-lg bg-light"
                                            id="notes"
                                            name="notes"
                                            placeholder="Notes about your order, e.g. special notes for delivery"
                                            rows="4"
                                        ></textarea>
                                    </div>

                                    <!-- Payment Method -->
                                    <div class="mb-4 payment">
                                        <label class="form-label fw-medium mb-3"
                                            >Phương thức thanh toán</label
                                        >
                                        <div style="display: flex; gap: 60px">
                                            <div class="form-check">
                                                <input
                                                    class="form-check-input"
                                                    type="radio"
                                                    name="paymentMethod"
                                                    id="cash"
                                                    value="cash"
                                                    checked
                                                />
                                                <label
                                                    class="form-check-label"
                                                    for="cash"
                                                    >Cash on Delivery</label
                                                >
                                            </div>
                                            <div class="form-check">
                                                <input
                                                    class="form-check-input"
                                                    type="radio"
                                                    name="paymentMethod"
                                                    id="paypal"
                                                    value="paypal"
                                                />
                                                <label
                                                    class="form-check-label"
                                                    for="paypal"
                                                    >Paypal</label
                                                >
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Order Summary -->
                    <div class="col-lg-5">
                        <div
                            class="card border-light shadow-sm sticky-top"
                            style="top: 2rem"
                        >
                            <h2 class="card-title py-4 px-5">Order Summary</h2>
                            <div class="card-body px-5 py-4">
                                <!-- Products List -->
                                <div
                                    id="productsList"
                                    class="mb-4 pb-4 border-bottom"
                                >
                                    <!-- Products will be inserted here by JavaScript -->
                                </div>

                                <!-- Price Summary -->
                                <div class="mb-4">
                                    <div
                                        class="d-flex justify-content-between mb-3"
                                    >
                                        <span class="text-muted"
                                            >Sub total</span
                                        >
                                        <span
                                            class="fw-semibold"
                                            id="subtotal"
                                        ></span>
                                    </div>
                                    <div
                                        class="d-flex justify-content-between mb-3"
                                    >
                                        <span class="text-muted">Discount</span>
                                        <span class="fw-semibold" id="discount"
                                            >£3.45</span
                                        >
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Shipping</span>
                                        <span class="fw-semibold text-success"
                                            >Free</span
                                        >
                                    </div>
                                </div>

                                <!-- Total -->
                                <div class="border-top pt-4 mb-4">
                                    <div class="d-flex justify-content-between">
                                        <span class="fs-5 fw-bold">Total</span>
                                        <span
                                            class="fw-bold total"
                                            id="total"
                                        ></span>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <button
                                    type="submit"
                                    form="checkoutForm"
                                    id="checkoutBtn"
                                    class="btn btn-lg w-100"
                                    style="
                                        background-color: #714024;
                                        color: white;
                                    "
                                >
                                    Thanh toán đơn hàng
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Address Picker Modal -->
        <div
            class="infoAddress"
            id="addressModal"
            tabindex="-1"
            aria-labelledby="addressModalLabel"
        >
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header border-bottom">
                        <h5 class="modal-title" id="addressModalLabel">
                            Chọn địa chỉ
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body p-4">
                        <!-- Selection Inputs -->
                        <div class="row mb-2 g-3">
                            <div class="col-md-12">
                                <label
                                    for="specificAddress"
                                    class="form-label fw-medium"
                                    >Địa chỉ cụ thể</label
                                >
                                <input
                                    type="text"
                                    class="form-control form-control-lg bg-light"
                                    id="specificAddress"
                                    name="specificAddress"
                                    placeholder="Nhập địa chỉ"
                                />
                                <div class="invalid-feedback">
                                    Vui lòng nhập địa chỉ trước khi tiếp tục.
                                </div>
                            </div>
                        </div>
                        <button
                            type="button"
                            class="btn"
                            style="
                                background-color: #6b4423;
                                color: white;
                                margin-bottom: 10px;
                            "
                            onclick="getCurrentLocation()"
                        >
                            Lấy vị trí hiện tại
                        </button>
                        <!-- Map Placeholder -->
                        <div id="map"></div>

                        <!-- Nearby Locations List -->
                        <div>
                            <h6 class="fw-bold mt-4 mb-3">
                                Địa chỉ bạn đã lưu
                            </h6>
                            <div
                                id="locationsList"
                                class="list-group"
                                style="max-height: 300px; overflow-y: auto"
                            >
                                <!-- Locations will be inserted here by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div
                        class="modal-footer px-4 p-end-4"
                        style="margin: 0 auto 30px"
                    >
                        <button
                            type="button"
                            class="btn btn-secondary py-2 px-5"
                            data-bs-dismiss="modal"
                            style="
                                background-color: rgb(243, 243, 243);
                                color: rgb(37, 37, 37);
                                border: none;
                            "
                        >
                            Hủy
                        </button>
                        <button
                            type="button"
                            class="btn p-2 px-5"
                            id="confirmAddressBtn"
                            style="
                                background-color: #7e502a;
                                color: white;
                                margin-left: 20px;
                            "
                        >
                            Xác nhận địa chỉ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <%- include('../layout/footer.ejs'); -%>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

        <!-- Added jQuery library before custom script -->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="/client/js/cart/checkout.js"></script>
    </body>
</html>
