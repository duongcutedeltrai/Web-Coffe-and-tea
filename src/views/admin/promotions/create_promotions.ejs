<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Qu·∫£n l√Ω khuy·∫øn m√£i</title>
        <link
            rel="stylesheet"
            href="/admin/css/promotions/create_promotions.css"
        />
        <link rel="stylesheet" href="/admin/css/style.css" />
         <!--Favicon-->
        <link
            rel="shortcut icon"
            href="/images/favicon/favicon.ico"
            type="image/x-icon"
        />
        <link
            rel="icon"
            href="/images/favicon/favicon.ico"
            type="image/x-icon"
        />
    </head>
    <body>
        <div class="container">
            <%- include('../layout/sidebar.ejs'); -%> ; -%>
            <div class="main-content">
                <div class="content">
                    <div class="page-header">
                        <h1>Khuy·∫øn m√£i</h1>
                        <button
                            class="btn-primary"
                            onclick="openCreatePromotionDrawer()"
                        >
                            <span>+</span> T·∫°o khuy·∫øn m√£i m·ªõi
                        </button>
                    </div>

                    <div class="filters">
                        <div class="search">
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="T√¨m ki·∫øm theo m√£ ho·∫∑c m√¥ t·∫£..."
                            />
                        </div>
                        <select id="statusFilter" class="filter-select">
                            <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                            <option value="upcoming">S·∫Øp di·ªÖn ra</option>
                            <option value="expired">ƒê√£ h·∫øt h·∫°n</option>
                        </select>
                        <select id="membershipFilter" class="filter-select">
                            <option value="all">T·∫•t c·∫£ h·∫°ng th√†nh vi√™n</option>
                            <option value="bronze">ƒê·ªìng</option>
                            <option value="silver">B·∫°c</option>
                            <option value="gold">V√†ng</option>
                            <option value="platinum">B·∫°ch kim</option>
                        </select>
                    </div>
                     <div class="tabs-list">
                                <button
                                    class="tab-trigger active"
                                    data-tab="Voucher"
                                    onclick="switchTab('Voucher')"
                                >
                                    Voucher
                                </button>
                                <button class="tab-trigger" data-tab="FlashSale" onclick="switchTab('FlashSale')">
                                    FlashSale
                                </button>  
                            </div>
                    
                    <!-- Th√™m container cho b·∫£ng flash sale -->
                    <div id="voucherTab" class="tab-content active">
                        <div class="promotions-container" id="promotionsContainer">
                            Promotions will be rendered here by JavaScript
                        </div>
                    </div>
                    
                    <div id="flashsaleTab" class="tab-content" style="display: none;">
                        <div class="flashsale-table-wrapper">
                            <table class="flashsale-table">
                                <thead>
                                    <tr>
                                        <th>T√™n s·∫£n ph·∫©m</th>
                                        <th>Size</th>
                                        <th>Gi√° g·ªëc</th>
                                        <th>Gi√° gi·∫£m</th>
                                        <th>B·∫Øt ƒë·∫ßu</th>
                                        <th>K·∫øt th√∫c</th>
                                        <th>S·ªë l∆∞·ª£ng</th>
                                        <th>S·ªë ti·ªÅn gi·∫£m</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody id="flashsaleTableBody">
                                    <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c render b·ªüi JavaScript -->
                                </tbody>
                            </table>
                            <div id="flashsaleEmptyState" class="empty-state" style="display: none;">
                                <div style="font-size: 48px; margin-bottom: 16px;">üì¶</div>
                                <div style="font-size: 18px; font-weight: 500; margin-bottom: 8px;">Kh√¥ng c√≥ flash sale n√†o</div>
                                <div style="font-size: 14px; color: #999;">T·∫°o flash sale m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div
            class="drawer-overlay"
            id="promotionDrawerOverlay"
            onclick="closePromotionDrawer()"
        ></div>
        <div class="promotion-drawer" id="promotionDrawer">
            <div class="drawer-header">
                <h2 id="drawerTitle">T·∫°o khuy·∫øn m√£i m·ªõi</h2>
                <button class="close-btn" onclick="closePromotionDrawer()">
                    √ó
                </button>
            </div>
            <div class="drawer-content">
                <form id="promotionForm">
                    <input type="hidden" id="promotionId" />

                    <div class="form-section">
                        <h3>Th√¥ng tin c∆° b·∫£n</h3>
                         <div class="form-group">
                            <label for="promotionType">Ch·ªçn lo·∫°i khuy·∫øn m√£i</label>
                            <select id="promotionType" onchange="togglePromotionType()">
                                <option value="voucher" selected>Voucher (nh·∫≠p m√£ gi·∫£m gi√°)</option>
                                <option value="flashsale">Flash Sale (gi·∫£m gi√° ch·ªõp nho√°ng)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="promotionCode"
                                >M√£ khuy·∫øn m√£i
                                <span class="required">*</span></label
                            >
                            <input
                                type="text"
                                id="promotionCode"
                                placeholder="VD: SUMMER2024"
                                required
                            />
                        </div>

                        <div class="form-group">
                            <label for="promotionDescription"
                                >M√¥ t·∫£ <span class="required">*</span></label
                            >
                            <textarea
                                id="promotionDescription"
                                rows="3"
                                placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ ch∆∞∆°ng tr√¨nh khuy·∫øn m√£i"
                                required
                            ></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Th·ªùi gian √°p d·ª•ng</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="startDate"
                                    >Ng√†y b·∫Øt ƒë·∫ßu
                                    <span class="required">*</span></label
                                >
                                <input
                                    type="datetime-local"
                                    id="startDate"
                                    required
                                />
                            </div>
                            <div class="form-group">
                                <label for="endDate"
                                    >Ng√†y k·∫øt th√∫c
                                    <span class="required">*</span></label
                                >
                                <input
                                    type="datetime-local"
                                    id="endDate"
                                    required
                                />
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>ƒêi·ªÅu ki·ªán √°p d·ª•ng</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="discountPercent"
                                    >Ph·∫ßn trƒÉm gi·∫£m gi√° (%)
                                    <span class="required">*</span></label
                                >
                                <input
                                    type="number"
                                    id="discountPercent"
                                    min="0"
                                    max="100"
                                    placeholder="VD: 20"
                                    required
                                />
                            </div><div class="form-group">
                                <label for="discountPrice"
                                    >Gi√° khuy·∫øn m√£i (VNƒê)
                                    <span class="required">*</span></label
                                >
                                <input
                                    type="number"
                                    id="discountPrice"
                                    min="0"
                                    placeholder="VD: 20.000ƒë"
                                    required
                                />
                            </div>
                            <div class="form-group">
                                <label for="maxUsageCount"
                                    >S·ªë l·∫ßn s·ª≠ d·ª•ng t·ªëi ƒëa</label
                                >
                                <input
                                    type="number"
                                    id="maxUsageCount"
                                    min="1"
                                    placeholder="VD: 100"
                                />
                            </div>
                            
                        </div>

                        <div class="form-row">

                            <div class="form-group">
                                <label for="currentUsage"
                                    >S·ªë l·∫ßn ƒë√£ s·ª≠ d·ª•ng</label
                                >
                                <input
                                    type="number"
                                    id="currentUsage"
                                    min="0"
                                    value="0"
                                    readonly
                                />
                            </div>
                            <div class="form-group">
                                <label for="minOrderAmount"
                                    >Gi√° tr·ªã ƒë∆°n h√†ng t·ªëi thi·ªÉu (‚Ç´)</label
                                >
                                <input
                                    type="number"
                                    id="minOrderAmount"
                                    min="0"
                                    placeholder="VD: 100000"
                                />
                            </div>
                        </div>
                    </div>

                    <div class="form-section" id="membership">
                        <h3>ƒê·ªëi t∆∞·ª£ng √°p d·ª•ng</h3>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="isForNewUser" />
                                <span>Ch·ªâ d√†nh cho kh√°ch h√†ng m·ªõi</span>
                            </label>
                        </div>

                        <div class="form-group">
                            <label for="applicableMembership"
                                >H·∫°ng th√†nh vi√™n √°p d·ª•ng</label
                            >
                            <select id="applicableMembership" multiple size="4">
                                <option value="bronze">ƒê·ªìng</option>
                                <option value="silver">B·∫°c</option>
                                <option value="gold">V√†ng</option>
                                <option value="platinum">B·∫°ch kim</option>
                            </select>
                            <small class="form-hint"
                                >Gi·ªØ Ctrl (ho·∫∑c Cmd) ƒë·ªÉ ch·ªçn nhi·ªÅu h·∫°ng</small
                            >
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>S·∫£n ph·∫©m √°p d·ª•ng</h3>

                        <div class="form-group">
                            <label>
                                <input
                                    type="radio"
                                    name="productScope"
                                    value="all"
                                    checked
                                    onchange="toggleProductSelection()"
                                />
                                √Åp d·ª•ng cho t·∫•t c·∫£ s·∫£n ph·∫©m
                            </label>
                        </div>

                        <div class="form-group">
                            <label>
                                <input
                                    type="radio"
                                    name="productScope"
                                    value="specific"
                                    onchange="toggleProductSelection()"
                                />
                                Ch·ªçn s·∫£n ph·∫©m c·ª• th·ªÉ
                            </label>
                        </div>

                        <div
                            id="productSelectionContainer"
                            style="display: none"
                        >
                            <div class="product-search-box">
                                <input
                                    type="text"
                                    id="productSearchInput"
                                    placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..."
                                />
                            </div>

                            <div class="product-categories"></div>

                            <div
                                class="selected-products-summary"
                                id="selectedProductsSummary"
                            >
                                <span
                                    >ƒê√£ ch·ªçn: <strong>0</strong> s·∫£n ph·∫©m</span
                                >
                            </div>

                            <div
                                class="product-selection-grid"
                                id="productSelectionGrid"
                            >
                                Products will be rendered here
                            </div>
                        </div>
                    </div>

                    <div class="drawer-footer">
                        <button
                            type="button"
                            class="btn-secondary"
                            onclick="closePromotionDrawer()"
                        >
                            H·ªßy
                        </button>
                        <button
                            type="button"
                            class="btn-primary"
                            onclick="submitPromotions()"
                        >
                            L∆∞u khuy·∫øn m√£i
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Th√™m modal chi ti·∫øt flash sale -->
        <div
            class="modal-overlay"
            id="flashsaleDetailsOverlay"
            onclick="closeFlashsaleDetails()"
        >
            <div
                class="modal"
                id="flashsaleDetailsModal"
                onclick="event.stopPropagation()"
            >
                <div class="modal-header">
                    <h2>Chi ti·∫øt Flash Sale</h2>
                    <button class="close-btn" onclick="closeFlashsaleDetails()">
                        √ó
                    </button>
                </div>
                <div class="modal-content" id="flashsaleDetailsContent">
                    Content will be populated by JavaScript
                </div>
            </div>
        </div>

        <div
            class="modal-overlay"
            id="promotionDetailsOverlay"
            onclick="closePromotionDetails()"
        >
            <div
                class="modal"
                id="promotionDetailsModal"
                onclick="event.stopPropagation()"
            >
                <div class="modal-header">
                    <h2>Chi ti·∫øt khuy·∫øn m√£i</h2>
                    <button class="close-btn" onclick="closePromotionDetails()">
                        √ó
                    </button>
                </div>
                <div class="modal-content" id="promotionDetailsContent">
                    Content will be populated by JavaScript
                </div>
            </div>
        </div>

        <script src="/admin/js/promotions/create_promotions.js"></script>
    </body>
</html>
